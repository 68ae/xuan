<include file='Public/top'/>
<body class="hold-transition skin-purple sidebar-mini">
<div class="wrapper">
  <!-- Left side column. contains the logo and sidebar -->
<include file='Public/left'/>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Main content -->
    <!-- /.content -->
    <section class="content">
      <div class="row">
        <div class="col-xs-8">
          <div class="box box-primary">
            <div class="box-header">
              <h3 class="box-title">文章修改</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body">
                <form class="panel-body" id="form_add_news" name="form_add_news" method="POST" enctype="multipart/form-data">
                    <div role="form" class="col-lg-12">
                        <div class="form-group">
                            <label>标题</label>
                            <input class="form-control" placeholder="请输入标题" value="{$blogs['title']}" id="title" name="title">
                        </div>
                    </div>
                    <div role="form" class="col-lg-12">
                        <div class="form-group">
                            <label>内容</label>
                            <script id="content" name="content" type="text/plain">{$blogs['content']}</script>
                            <textarea style="display:none" id="contentT"  name="contentT">{$blogs['content']}</textarea>
                        </div>
                    </div>
                    <div role="form" class="col-lg-4">
                        <div class="form-group">
                            <label>标签</label>
                            <input class="form-control" placeholder="文章标签，逗号或空格分隔，过多的标签会影响系统运行效率" value="{$blogs['tag']}" id="tag" name="tag">
                        </div>
                    </div>
                    <div role="form" class="col-lg-4">
                        <div class="form-group">
                            <label>分类</label>
                            <select class="form-control" id="sort" name="sort">
                                <option value="">请选择</option>
                                <foreach name="sorts" item="sort">
                                    <if condition="$sort.pid eq 0">
                                        <option value="{$sort.sid}" <if condition="$sort.sid eq $blogs['sortid']"> selected = "selected" </if>>{$sort.sortname}</option>
                                        <foreach name="sorts" item="tt">
                                            <if condition="$sort['sid'] eq $tt['pid']">
                                                <option value="{$tt.sid}" <if condition="$tt.sid eq $blogs['sortid']"> selected = "selected" </if>>&nbsp;&nbsp;&nbsp;&nbsp;{$tt.sortname}</option>
                                            </if>
                                        </foreach>
                                    </if>
                                </foreach>
                            </select>
                        </div>
                    </div>
                    <div role="form" class="col-lg-4">
                        <div class="form-group">
                            <label>发布时间</label>
                            <input class="form-control" id="date" name="date" value="{:date("Y-m-d H:i:s", $blogs['date'])}">
                        </div>
                    </div>

                    <div role="form" class="col-lg-12">
                        <div class="panel">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" class="collapsed">高级选项</a>
                                </h4>
                            </div>
                            <div id="collapseOne" class="panel-collapse collapse" aria-expanded="false" style="height: 0px;">
                                <div class="panel-body">
                                    <div role="form" class="col-lg-12">
                                        <div class="form-group">
                                            <label>文章摘要</label>
                                            <textarea class="form-control" rows="3" value="{$blogs['excerpt']}" id="excerpt" name="excerpt"></textarea>
                                        </div>
                                    </div>

                                    <div role="form" class="col-lg-4">
                                        <div class="form-group">
                                            <input class="form-control" id="password" name="password" value="{$blogs['password']}" placeholder="文章访问密码:不设置,请留空.">
                                        </div>
                                    </div>
                                    <div class="col-lg-2">
                                        <div class="checkbox">
                                          <label>
                                            <input type="checkbox" value="y" id="top" name="top" <if condition="$blogs['top'] eq y"> checked </if>>文章置顶
                                          </label>
                                        </div>
                                    </div>
                                    <div class="col-lg-2">
                                        <div class="checkbox">
                                          <label>
                                            <input type="checkbox" value="y" id="sortop" name="sortop" <if condition="$blogs['sortop'] eq y"> checked </if>>分类置顶
                                          </label>
                                        </div>
                                    </div>
                                    <div class="col-lg-2">
                                        <div class="checkbox">
                                          <label>
                                            <input type="checkbox" value="y" id="allow_remark" name="allow_remark"  <if condition="$blogs['allow_remark'] eq y"> checked </if>>允许评论
                                          </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="gid" name="gid" value="{$gid}">
                    {__TOKEN__}
                    <div role="form" class="col-lg-12">
                        <button type="submit" class="btn btn-primary">提交</button>
                        <button type="reset" class="btn btn-default" onclick="javascript:history.go(-1);">取消</button>
                    </div>
                </form>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
  <!-- /.content-wrapper -->
  <include file='Public/foot'/>
  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
       immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->
<!-- Bootstrap 3.3.6 -->
<script src="/Public/adc/bootstrap/js/bootstrap.min.js"></script>
<!-- FastClick -->
<script src="/Public/adc/plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="/Public/adc/dist/js/app.min.js"></script>
<!-- SlimScroll 1.3.0 -->
<script src="/Public/adc/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- 验证 -->
<script type="text/javascript" src="/Public/adc/validate/jquery.validate.min.js"></script>
<script type="text/javascript" src="/Public/adc/validate/messages_zh.js"></script>
<!-- 编辑器源码文件 -->
<script type="text/javascript" src="/Public/adc/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="/Public/adc/ueditor/ueditor.all.js"></script>
<script src="/Public/layer/layer.js"></script>
<!-- 实例化编辑器 -->
<script type="text/javascript">
    var ue = UE.getEditor('content',{
        initialFrameHeight: 260
    });
</script>
<script type="text/javascript">
    // 通过监听验证富文本
    ue.addListener("blur",function(){
      var contentT = ue.getContent();
      $('#contentT').val(contentT);
    })
    //验证
    $().ready(function() {
        $("#form_add_news").validate({
            ignore: "", //验证隐藏域
            rules: {
                title:     { required: true },
                contentT:  { required: true },
                sort:      { required: true },
                date:      { required: true }
            },
            //通过之后回调
            submitHandler: function(form) {
                var param = $("#form_add_news").serialize();
                $.ajax({
                    url : "/index.php/adc/news/newsEditSave",
                    type : "post",
                    dataType : "json",
                    data: param,
                    success : function(data) {
                        if(data.result == 'success') {
                            location.href='/index.php/adc/news/newslist';
                        }
                        else {
                            layer.msg(data.msg);
                        }
                    }
                });
            },
            //不通过回调
            invalidHandler: function(form, validator) {
                return false;
            }
        });
    });
    //验证结束
    </script>
</body>
</html>
